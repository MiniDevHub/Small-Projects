.PHONY: help install clean dev build preview test lint format audit deps check-node check-env status stop

# Colors
RED := \033[0;31m
GREEN := \033[0;32m
YELLOW := \033[1;33m
CYAN := \033[0;36m
PURPLE := \033[0;35m
BLUE := \033[0;34m
NC := \033[0m

# Variables
NODE_MIN_VERSION := 18.0.0
NPM_MIN_VERSION := 9.0.0
FRONTEND_PORT := 5173
BACKEND_URL := http://localhost:8000
NODE_MODULES := node_modules
BUILD_DIR := dist

help:
	@echo ""
	@echo "$(CYAN)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(CYAN)â•‘       âš›ï¸  E-Bike Point ERP - Frontend Setup            â•‘$(NC)"
	@echo "$(CYAN)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(BLUE)Usage: make <targetName>$(NC)"
	@echo ""
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(PURPLE)ğŸš€ Quick Start$(NC)"
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "  $(CYAN)install$(NC)              => ğŸ“¦ Install all dependencies"
	@echo "  $(CYAN)dev$(NC)                  => ğŸ”§ Start development server"
	@echo "  $(CYAN)build$(NC)                => ğŸ—ï¸  Build for production"
	@echo "  $(CYAN)preview$(NC)              => ğŸ‘€ Preview production build"
	@echo ""
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(PURPLE)ğŸ’» Development$(NC)"
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "  $(CYAN)dev$(NC)                  => ğŸŒ Start Vite dev server (:5173)"
	@echo "  $(CYAN)dev-host$(NC)             => ğŸŒ Dev server (network accessible)"
	@echo "  $(CYAN)dev-open$(NC)             => ğŸŒ Dev server (auto-open browser)"
	@echo "  $(CYAN)stop$(NC)                 => ğŸ›‘ Stop development server"
	@echo "  $(CYAN)restart$(NC)              => ğŸ”„ Restart dev server"
	@echo ""
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(PURPLE)ğŸ—ï¸  Build & Deploy$(NC)"
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "  $(CYAN)build$(NC)                => ğŸ—ï¸  Build for production (dist/)"
	@echo "  $(CYAN)build-check$(NC)          => âœ… Build and check for errors"
	@echo "  $(CYAN)preview$(NC)              => ğŸ‘€ Preview production build locally"
	@echo "  $(CYAN)build-analyze$(NC)        => ğŸ“Š Analyze bundle size"
	@echo ""
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(PURPLE)ğŸ§ª Testing & Quality$(NC)"
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "  $(CYAN)test$(NC)                 => ğŸ§ª Run tests (if configured)"
	@echo "  $(CYAN)lint$(NC)                 => ğŸ” Run ESLint"
	@echo "  $(CYAN)lint-fix$(NC)             => ğŸ”§ Fix ESLint errors"
	@echo "  $(CYAN)format$(NC)               => âœ¨ Format code with Prettier"
	@echo "  $(CYAN)format-check$(NC)         => ğŸ” Check code formatting"
	@echo "  $(CYAN)typecheck$(NC)            => ğŸ” Run TypeScript type check"
	@echo "  $(CYAN)audit$(NC)                => ğŸ”’ Security audit (npm audit)"
	@echo "  $(CYAN)audit-fix$(NC)            => ğŸ”§ Fix security issues"
	@echo ""
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(PURPLE)ğŸ“¦ Dependencies$(NC)"
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "  $(CYAN)deps$(NC)                 => ğŸ“‹ List installed dependencies"
	@echo "  $(CYAN)deps-outdated$(NC)        => ğŸ“‹ Check for outdated packages"
	@echo "  $(CYAN)deps-update$(NC)          => â¬†ï¸  Update all dependencies"
	@echo "  $(CYAN)deps-update-minor$(NC)    => â¬†ï¸  Update minor versions only"
	@echo "  $(CYAN)deps-clean$(NC)           => ğŸ§¹ Remove node_modules & reinstall"
	@echo ""
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(PURPLE)ğŸ”§ Setup & Maintenance$(NC)"
	@echo "$(PURPLE)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "  $(CYAN)check-node$(NC)           => ğŸ” Check Node.js & npm versions"
	@echo "  $(CYAN)check-env$(NC)            => ğŸ” Verify .env file"
	@echo "  $(CYAN)check-backend$(NC)        => ğŸ” Check backend connectivity"
	@echo "  $(CYAN)status$(NC)               => ğŸ“Š Show complete system status"
	@echo "  $(CYAN)clean$(NC)                => ğŸ§¹ Clean build files & cache"
	@echo "  $(CYAN)clean-all$(NC)            => ğŸ§¹ Deep clean (includes node_modules)"
	@echo ""
	@echo "$(YELLOW)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(YELLOW)ğŸ’¡ Quick Start Guide:$(NC)"
	@echo "$(YELLOW)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "  $(GREEN)1.$(NC) make install              $(BLUE)# Install dependencies$(NC)"
	@echo "  $(GREEN)2.$(NC) make check-env            $(BLUE)# Verify environment$(NC)"
	@echo "  $(GREEN)3.$(NC) make dev                  $(BLUE)# Start dev server$(NC)"
	@echo "  $(GREEN)4.$(NC) Visit: $(CYAN)http://localhost:5173$(NC)"
	@echo ""
	@echo "$(YELLOW)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(YELLOW)ğŸ“š Common Workflows:$(NC)"
	@echo "$(YELLOW)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "  $(CYAN)Development:$(NC)        make dev"
	@echo "  $(CYAN)Production:$(NC)         make build && make preview"
	@echo "  $(CYAN)Code Quality:$(NC)       make lint && make format"
	@echo "  $(CYAN)Testing:$(NC)            make test"
	@echo "  $(CYAN)Security:$(NC)           make audit"
	@echo "  $(CYAN)Fresh Install:$(NC)      make clean-all && make install"
	@echo ""
	@echo "$(GREEN)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(GREEN)ğŸŒ Service URLs:$(NC)"
	@echo "$(GREEN)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "  â€¢ Frontend:   $(CYAN)http://localhost:5173$(NC)"
	@echo "  â€¢ Backend:    $(CYAN)http://localhost:8000$(NC)"
	@echo ""
	@echo "$(RED)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "$(RED)âš ï¸  Important Notes:$(NC)"
	@echo "$(RED)â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”$(NC)"
	@echo "  â€¢ Ensure backend is running at http://localhost:8000"
	@echo "  â€¢ Update .env file before starting development"
	@echo "  â€¢ Run 'make check-backend' to verify API connection"
	@echo "  â€¢ Use 'make stop' to stop the dev server"
	@echo ""

check-node:
	@echo "$(YELLOW)ğŸ” Checking Node.js and npm versions...$(NC)"
	@command -v node >/dev/null 2>&1 || { \
		echo "$(RED)âŒ Node.js not found!$(NC)"; \
		echo "$(YELLOW)   Install from: https://nodejs.org$(NC)"; \
		exit 1; \
	}
	@command -v npm >/dev/null 2>&1 || { \
		echo "$(RED)âŒ npm not found!$(NC)"; \
		exit 1; \
	}
	@NODE_VERSION=$$(node -v | sed 's/v//'); \
	NODE_MAJOR=$$(echo $$NODE_VERSION | cut -d. -f1); \
	if [ $$NODE_MAJOR -lt 18 ]; then \
		echo "$(RED)âŒ Node.js 18+ required!$(NC)"; \
		echo "$(YELLOW)   Current: v$$NODE_VERSION$(NC)"; \
		echo "$(YELLOW)   Update from: https://nodejs.org$(NC)"; \
		exit 1; \
	fi
	@echo "$(GREEN)âœ“ Node.js: $$(node -v)$(NC)"
	@echo "$(GREEN)âœ“ npm: $$(npm -v)$(NC)"

check-env:
	@echo "$(YELLOW)ğŸ” Checking environment file...$(NC)"
	@if [ ! -f .env ]; then \
		echo "$(YELLOW)âš ï¸  .env file not found$(NC)"; \
		if [ -f .env.example ]; then \
			echo "$(CYAN)ğŸ“‹ Creating from .env.example...$(NC)"; \
			cp .env.example .env; \
			echo "$(GREEN)âœ“ Created .env file$(NC)"; \
			echo "$(RED)âš ï¸  IMPORTANT: Please update .env with your values!$(NC)"; \
			echo ""; \
			echo "$(CYAN)Required configurations:$(NC)"; \
			echo "  â€¢ VITE_API_BASE_URL=http://localhost:8000/api"; \
			echo "  â€¢ VITE_APP_NAME=E-Bike Point"; \
			echo ""; \
		else \
			echo "$(RED)âŒ Please create .env file$(NC)"; \
			echo "$(CYAN)Create .env with:$(NC)"; \
			echo "  VITE_API_BASE_URL=http://localhost:8000/api"; \
			echo "  VITE_APP_NAME=E-Bike Point"; \
			echo "  VITE_AUTO_LOGOUT_HOURS=9"; \
			echo "  VITE_FREE_SERVICES_COUNT=4"; \
			echo "  VITE_WARRANTY_MONTHS=24"; \
			exit 1; \
		fi \
	else \
		echo "$(GREEN)âœ“ .env file exists$(NC)"; \
		if grep -q "VITE_API_BASE_URL" .env; then \
			BACKEND_URL=$$(grep VITE_API_BASE_URL .env | cut -d '=' -f2); \
			echo "$(CYAN)  Backend URL: $$BACKEND_URL$(NC)"; \
		fi \
	fi

check-backend:
	@echo "$(YELLOW)ğŸ” Checking backend connectivity...$(NC)"
	@BACKEND_URL=$$(grep VITE_API_BASE_URL .env 2>/dev/null | cut -d '=' -f2 | tr -d ' ' || echo "http://localhost:8000/api"); \
	echo "$(CYAN)Testing: $$BACKEND_URL$(NC)"; \
	if curl -s -o /dev/null -w "%{http_code}" $$BACKEND_URL | grep -q "200\|301\|302"; then \
		echo "$(GREEN)âœ“ Backend is accessible$(NC)"; \
	else \
		echo "$(RED)âœ— Backend not accessible$(NC)"; \
		echo "$(YELLOW)  Make sure backend is running:$(NC)"; \
		echo "  $(CYAN)cd ../server && make dev$(NC)"; \
	fi

install: check-node
	@echo "$(PURPLE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(PURPLE)â•‘     ğŸ”§ Installing Frontend                â•‘$(NC)"
	@echo "$(PURPLE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@if [ -d "$(NODE_MODULES)" ]; then \
		echo "$(YELLOW)âš ï¸  node_modules already exists$(NC)"; \
		echo "$(CYAN)ğŸ’¡ Use 'make deps-clean' for fresh install$(NC)"; \
		echo ""; \
	fi
	@echo "$(YELLOW)ğŸ“¦ Installing dependencies...$(NC)"
	@npm install
	@echo "$(GREEN)âœ“ Dependencies installed$(NC)"
	@echo ""
	@$(MAKE) check-env
	@echo ""
	@echo "$(GREEN)âœ… Installation complete!$(NC)"
	@echo ""
	@echo "$(BLUE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(BLUE)â•‘           ğŸ“‹ Next Steps                      â•‘$(NC)"
	@echo "$(BLUE)â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£$(NC)"
	@echo "$(BLUE)â•‘$(NC)  1. Update .env with backend URL             $(BLUE)â•‘$(NC)"
	@echo "$(BLUE)â•‘$(NC)  2. Ensure backend is running                $(BLUE)â•‘$(NC)"
	@echo "$(BLUE)â•‘$(NC)  3. Run 'make dev' to start                  $(BLUE)â•‘$(NC)"
	@echo "$(BLUE)â•‘$(NC)  4. Visit http://localhost:5173              $(BLUE)â•‘$(NC)"
	@echo "$(BLUE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""

dev: check-env
	@echo "$(PURPLE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(PURPLE)â•‘      ğŸš€ Starting Vite Dev Server          â•‘$(NC)"
	@echo "$(PURPLE)â• â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•£$(NC)"
	@echo "$(PURPLE)â•‘       http://localhost:$(FRONTEND_PORT)               â•‘$(NC)"
	@echo "$(PURPLE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@npm run dev

dev-host:
	@echo "$(PURPLE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(PURPLE)â•‘  ğŸŒ Starting Dev Server (Network Access) â•‘$(NC)"
	@echo "$(PURPLE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@npm run dev -- --host

dev-open:
	@echo "$(PURPLE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(PURPLE)â•‘  ğŸš€ Starting Dev Server (Auto-Open)      â•‘$(NC)"
	@echo "$(PURPLE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@npm run dev -- --open

build:
	@echo "$(YELLOW)ğŸ—ï¸  Building for production...$(NC)"
	@npm run build
	@echo "$(GREEN)âœ“ Build complete!$(NC)"
	@echo "$(CYAN)ğŸ“¦ Output: $(BUILD_DIR)/$(NC)"
	@if [ -d "$(BUILD_DIR)" ]; then \
		SIZE=$$(du -sh $(BUILD_DIR) | cut -f1); \
		echo "$(CYAN)ğŸ“Š Build size: $$SIZE$(NC)"; \
	fi

build-check: build
	@echo ""
	@echo "$(YELLOW)ğŸ” Checking build for errors...$(NC)"
	@if [ -d "$(BUILD_DIR)" ]; then \
		echo "$(GREEN)âœ“ Build directory exists$(NC)"; \
		if [ -f "$(BUILD_DIR)/index.html" ]; then \
			echo "$(GREEN)âœ“ index.html found$(NC)"; \
		else \
			echo "$(RED)âœ— index.html missing$(NC)"; \
		fi \
	else \
		echo "$(RED)âœ— Build directory missing$(NC)"; \
	fi

preview: build
	@echo "$(CYAN)ğŸ‘€ Previewing production build...$(NC)"
	@npm run preview

build-analyze:
	@echo "$(YELLOW)ğŸ“Š Analyzing bundle size...$(NC)"
	@npm run build -- --mode analyze 2>/dev/null || { \
		echo "$(YELLOW)âš ï¸  Bundle analyzer not configured$(NC)"; \
		echo "$(CYAN)Install: npm install -D rollup-plugin-visualizer$(NC)"; \
	}

test:
	@echo "$(YELLOW)ğŸ§ª Running tests...$(NC)"
	@npm run test 2>/dev/null || { \
		echo "$(YELLOW)âš ï¸  No tests configured$(NC)"; \
		echo "$(CYAN)Add Vitest: npm install -D vitest$(NC)"; \
	}

lint:
	@echo "$(YELLOW)ğŸ” Running ESLint...$(NC)"
	@npm run lint 2>/dev/null || { \
		npx eslint src --ext .js,.jsx,.ts,.tsx 2>/dev/null || { \
			echo "$(YELLOW)âš ï¸  ESLint not configured$(NC)"; \
		}; \
	}

lint-fix:
	@echo "$(YELLOW)ğŸ”§ Fixing ESLint errors...$(NC)"
	@npm run lint:fix 2>/dev/null || { \
		npx eslint src --ext .js,.jsx,.ts,.tsx --fix 2>/dev/null || { \
			echo "$(YELLOW)âš ï¸  ESLint not configured$(NC)"; \
		}; \
	}

format:
	@echo "$(YELLOW)âœ¨ Formatting code with Prettier...$(NC)"
	@npx prettier --write src/ 2>/dev/null || { \
		echo "$(YELLOW)âš ï¸  Prettier not installed$(NC)"; \
		echo "$(CYAN)Install: npm install -D prettier$(NC)"; \
	}
	@echo "$(GREEN)âœ“ Code formatted$(NC)"

format-check:
	@echo "$(YELLOW)ğŸ” Checking code formatting...$(NC)"
	@npx prettier --check src/ 2>/dev/null || { \
		echo "$(YELLOW)âš ï¸  Prettier not installed$(NC)"; \
	}

typecheck:
	@echo "$(YELLOW)ğŸ” Running TypeScript type check...$(NC)"
	@npx tsc --noEmit 2>/dev/null || { \
		echo "$(YELLOW)âš ï¸  TypeScript not configured$(NC)"; \
	}

audit:
	@echo "$(YELLOW)ğŸ”’ Running security audit...$(NC)"
	@npm audit
	@echo ""
	@echo "$(CYAN)ğŸ’¡ Use 'make audit-fix' to fix issues$(NC)"

audit-fix:
	@echo "$(YELLOW)ğŸ”§ Fixing security vulnerabilities...$(NC)"
	@npm audit fix
	@echo "$(GREEN)âœ“ Audit fixes applied$(NC)"

deps:
	@echo "$(CYAN)ğŸ“‹ Installed dependencies:$(NC)"
	@npm list --depth=0

deps-outdated:
	@echo "$(YELLOW)ğŸ“‹ Checking for outdated packages...$(NC)"
	@npm outdated || echo "$(GREEN)âœ“ All packages up to date$(NC)"

deps-update:
	@echo "$(YELLOW)â¬†ï¸  Updating all dependencies...$(NC)"
	@npm update
	@echo "$(GREEN)âœ“ Dependencies updated$(NC)"
	@echo "$(CYAN)ğŸ’¡ Run 'make audit' to check for issues$(NC)"

deps-update-minor:
	@echo "$(YELLOW)â¬†ï¸  Updating minor versions only...$(NC)"
	@npm update --depth 0
	@echo "$(GREEN)âœ“ Minor updates applied$(NC)"

deps-clean:
	@echo "$(RED)ğŸ§¹ Removing node_modules...$(NC)"
	@rm -rf $(NODE_MODULES)
	@rm -rf package-lock.json
	@echo "$(GREEN)âœ“ Cleaned$(NC)"
	@echo ""
	@echo "$(YELLOW)ğŸ“¦ Reinstalling dependencies...$(NC)"
	@npm install
	@echo "$(GREEN)âœ“ Fresh installation complete$(NC)"

clean:
	@echo "$(RED)ğŸ§¹ Cleaning build files and cache...$(NC)"
	@rm -rf $(BUILD_DIR)
	@rm -rf .vite
	@rm -rf node_modules/.vite
	@rm -rf .eslintcache
	@echo "$(GREEN)âœ“ Cleaned build files$(NC)"

clean-all: clean
	@echo "$(RED)ğŸ§¹ Deep cleaning (removing node_modules)...$(NC)"
	@rm -rf $(NODE_MODULES)
	@rm -rf package-lock.json
	@echo "$(GREEN)âœ“ Deep clean complete$(NC)"
	@echo "$(CYAN)ğŸ’¡ Run 'make install' to reinstall$(NC)"

stop:
	@echo "$(RED)ğŸ›‘ Stopping development server...$(NC)"
	@lsof -ti:$(FRONTEND_PORT) | xargs kill -9 2>/dev/null || true
	@echo "$(GREEN)âœ“ Server stopped$(NC)"

restart: stop dev

status:
	@echo "$(PURPLE)â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—$(NC)"
	@echo "$(PURPLE)â•‘        ğŸ“Š Frontend Status                 â•‘$(NC)"
	@echo "$(PURPLE)â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•$(NC)"
	@echo ""
	@echo "$(CYAN)Installation:$(NC)"
	@echo "  Node.js: $(shell node -v 2>/dev/null || echo '$(RED)âœ— Not installed$(NC)')"
	@echo "  npm: $(shell npm -v 2>/dev/null || echo '$(RED)âœ— Not installed$(NC)')"
	@echo "  Dependencies: $(shell [ -d $(NODE_MODULES) ] && echo '$(GREEN)âœ“ Installed$(NC)' || echo '$(RED)âœ— Not installed$(NC)')"
	@if [ -d $(NODE_MODULES) ]; then \
		PKG_COUNT=$$(ls -1 $(NODE_MODULES) | wc -l | xargs); \
		echo "    Packages: $(GREEN)$$PKG_COUNT installed$(NC)"; \
	fi
	@echo ""
	@echo "$(CYAN)Environment:$(NC)"
	@echo "  .env file: $(shell [ -f .env ] && echo '$(GREEN)âœ“ Exists$(NC)' || echo '$(RED)âœ— Missing$(NC)')"
	@if [ -f .env ]; then \
		if grep -q "VITE_API_BASE_URL" .env; then \
			BACKEND=$$(grep VITE_API_BASE_URL .env | cut -d '=' -f2 | tr -d ' '); \
			echo "    Backend: $(CYAN)$$BACKEND$(NC)"; \
		fi \
	fi
	@echo ""
	@echo "$(CYAN)Services:$(NC)"
	@echo "  Dev Server: $(shell lsof -Pi :$(FRONTEND_PORT) -sTCP:LISTEN -t >/dev/null 2>&1 && echo '$(GREEN)âœ“ Running :$(FRONTEND_PORT)$(NC)' || echo '$(YELLOW)â—‹ Stopped$(NC)')"
	@echo ""
	@echo "$(CYAN)Build:$(NC)"
	@echo "  Build dir: $(shell [ -d $(BUILD_DIR) ] && echo '$(GREEN)âœ“ Exists$(NC)' || echo '$(YELLOW)â—‹ Not built$(NC)')"
	@if [ -d $(BUILD_DIR) ]; then \
		SIZE=$$(du -sh $(BUILD_DIR) 2>/dev/null | cut -f1); \
		echo "    Size: $(CYAN)$$SIZE$(NC)"; \
	fi
	@echo ""

quick-check:
	@echo "$(CYAN)Quick Status Check:$(NC)"
	@echo -n "Node.js: "; command -v node >/dev/null 2>&1 && echo "$(GREEN)âœ“$(NC)" || echo "$(RED)âœ—$(NC)"
	@echo -n "npm: "; command -v npm >/dev/null 2>&1 && echo "$(GREEN)âœ“$(NC)" || echo "$(RED)âœ—$(NC)"
	@echo -n "Dependencies: "; [ -d $(NODE_MODULES) ] && echo "$(GREEN)âœ“$(NC)" || echo "$(RED)âœ—$(NC)"
	@echo -n "Dev Server: "; lsof -Pi :$(FRONTEND_PORT) -sTCP:LISTEN -t >/dev/null 2>&1 && echo "$(GREEN)âœ“$(NC)" || echo "$(RED)âœ—$(NC)"
	@echo -n "Backend: "; curl -s -o /dev/null -w "%{http_code}" $(BACKEND_URL) | grep -q "200\|301\|302" && echo "$(GREEN)âœ“$(NC)" || echo "$(RED)âœ—$(NC)"

version:
	@echo "$(CYAN)E-Bike Point ERP Frontend$(NC)"
	@echo "Framework: React + Vite"
	@echo "Node.js: $(shell node -v)"
	@echo "npm: $(shell npm -v)"
	@if [ -f package.json ]; then \
		VERSION=$$(grep '"version"' package.json | head -1 | cut -d '"' -f4); \
		echo "Version: $$VERSION"; \
	fi

# Aliases
server: dev
run: dev
start: dev
install-deps: install
update: deps-update
sec-audit: audit

.DEFAULT_GOAL := help
